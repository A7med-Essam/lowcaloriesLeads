<nav class="navbar navbar-expand-md fixed-top navbar-dark flex-fill no-print">
  <!-- <button class="sidebar-toggler ml-4" type="button">
      <i class="fa fa-navicon"></i>
    </button> -->
  <!-- header -->
  <div class="navbar-header pl-2 pr-2 ml-3 text-center">
    <a class="navbar-brand m-0 w-100">
      <!-- <i class="fa fa-flash mr-1"></i> -->
      <img src="../../../assets/images/logo.png" alt="lightning logo" width="35px" class="mb-1 mx-2">
      <span class="ms-3s">Low-Calories</span>
    </a>
  </div>
  <!-- sidebar toggler -->
  <div class="sidebar-toggler ml-auto mx-3" *ngIf="isLogin">
    <a class="btn nav-link" (click)="toggleSidebar()"><i class="fa fa-bars"></i></a>
  </div>
  <!-- right menu toggler -->
  <!-- <div class="nav-toggler-right mr-4 d-md-none" *ngIf="isLogin">
      <button class="" type="button" (click)="isCollapsed = !isCollapsed" [attr.aria-expanded]="!isCollapsed"
        aria-controls="collapseBasic">
        <img src="../../assets/images/default-avatar.png" class="img-fluid" alt="">
      </button>
      <span class="user-profile nav-alert bg-danger"></span>
    </div> -->
  <!-- left box -->
  <ul class="navbar-nav flex-fill mt-1 align-items-center left-nav" *ngIf="isLogin">
    <li class="nav-item navicon">
      <a class="btn nav-link" (click)="toggleSidebarPin()"><i class="fa fa-bars"></i></a>
    </li>
    <li class="nav-item flex-fill">
      <input class="form-control navbar-search" type="text" placeholder="Search . . .">
    </li>
  </ul>
  <!-- right menu -->
  <div class="collapse navbar-collapse right-nav" id="collapseBasic" *ngIf="isLogin" [attr.collapse]="isCollapsed">
    <ul class="navbar-nav ">
      <li class="nav-item" style="outline: 0px !important;">
        <a class="btn nav-link notifications-container" (click)="toggleNotifications()">
          <i class="far fa-bell"></i>
          <span class="link-text">Notifications</span>
          <span class="nav-alert notifications" *ngIf="hasNotification"></span>
          <div class="notification-list shadow-lg" id="style-3" *ngIf="hasNotification">
            <div class="overlay"></div>
            <div *ngFor="let notification of notifications" class="notification-item">
              <div class="d-flex align-items-center notification" [ngClass]="{'isReaded':notification.read == 0}"
                (click)="updateNotifications(notification)">
                <div>
                  <i class="fas" [ngClass]="{
                      'fa-people-carry': notification.type == 'lead',
                      'fa-headset': notification.type == 'call',
                      'fa-user-tag': notification.type == 'target',
                      'fa-hand-holding-usd': notification.type == 'refund',
                      'fa-thumbs-down': notification.type == 'dislike'
                    }"></i>
                </div>
                <div class="item text-start">
                  <div>{{notification.title}}</div>
                  <small class="text-muted">
                    {{notification.created_ago}}
                  </small>
                </div>
              </div>
              <hr class="my-0">
            </div>
          </div>
        </a>
      </li>
      <li class="nav-item">
        <a class="btn nav-link" routerLink="analysis/reminder">
          <i class="far fa-envelope"></i>
          <span class="link-text">Messages</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="btn nav-link" (click)="displayUploadModal()">
          <i class="fas fa-upload"></i>
          <span class="link-text">Upload</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="btn nav-link" (click)="openSearchModal()">
          <i class="fas fa-cog"></i>
          <span class="link-text">Setting</span>
        </a>
      </li>
    </ul>
  </div>
</nav>

<p-dialog [(visible)]="notificationModal" [modal]="true" [style]="{width: '25vw'}" [draggable]="false"
  [resizable]="false">
  <ng-container *ngIf="currentNotification?.notifications.length > 0; else noNotification">
    <div class="modal-content py-md-5 px-md-4 p-sm-3 p-4">
      <h3>{{ currentNotification?.notifications[0]?.title }}</h3>
      <i class="fa fa-bell"></i>
      <p class="r3 px-md-5 px-sm-1">{{ currentNotification?.notifications[0]?.details }}</p>

      <div class="text-center mb-3">
        <button class="btn btn-primary w-50 rounded-pill b1"
          (click)="redirect(currentNotification?.notifications[0]);notificationModal=false">
          GO TO {{ currentNotification?.notifications[0]?.type | uppercase }}
        </button>
      </div>

      <div class="notification-date">Created at: {{ currentNotification?.notifications[0]?.created_at | date }}</div>
      <div class="notification-ago">Created {{ currentNotification?.notifications[0]?.created_ago }}</div>
    </div>
  </ng-container>
  <ng-template #noNotification>
    <div class="no-notification">No notifications to display.</div>
  </ng-template>
</p-dialog>

<p-dialog [(visible)]="customerModal" [modal]="true" [style]="{width: '75vw'}" [draggable]="false" [resizable]="false">
  <div class="row customerModels">
    <p-tabView (onChange)="getModelDetails($event)" [scrollable]="true" [(activeIndex)]="tabOption">
      <p-tabPanel header="allSubscriptions">
        <p-table [value]="filter" [loading]="loadingTable" (onLazyLoad)="sort($event)">
          <ng-template pTemplate="header">
            <tr>
              <th class="text-center" pSortableColumn="invoice_no">invoice number
                <p-sortIcon field="invoice_no"></p-sortIcon>
              </th>
              <th class="text-center" pSortableColumn="subscriptions_note">subscriptions plan
                <p-sortIcon field="subscriptions_note"></p-sortIcon>
              </th>
              <th class="text-center" pSortableColumn="total_price">total price
                <p-sortIcon field="total_price"></p-sortIcon>
              </th>
              <th class="text-center" pSortableColumn="user.first_name">name
                <p-sortIcon field="user.first_name"></p-sortIcon>
              </th>
              <th class="text-center" pSortableColumn="created_at">created at
                <p-sortIcon field="created_at"></p-sortIcon>
              </th>
              <th class="text-center" pSortableColumn="delivery_starting_day">Starting Day
                <p-sortIcon field="delivery_starting_day"></p-sortIcon>
              </th>
              <th class="text-center" pSortableColumn="mode">Status
                <p-sortIcon field="mode"></p-sortIcon>
              </th>
              <th class="text-center" pSortableColumn="sub_from">sub_from
                <p-sortIcon field="sub_from"></p-sortIcon>
              </th>
              <th class="text-center">Actions</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-sub>
            <tr [pSelectableRow]="sub">
              <td class="text-center">{{sub.invoice_no}}</td>
              <td class="text-center">{{sub.subscriptions_note}}</td>
              <td class="text-center">{{sub.total_price}}</td>
              <td class="text-center">{{sub.user?.first_name}}</td>
              <td class="text-center">{{sub.created_at | date}}</td>
              <td class="text-center">{{sub.delivery_starting_day}}</td>
              <td class="text-center">
                <p-tag [severity]="getSeverity(sub.mode)" [value]="getMode(sub.mode)">
                </p-tag>
              </td>
              <td class="text-center">{{sub.sub_from}}</td>
              <td class="text-center">
                <button pButton type="button" icon="pi pi-eye" (click)="show_subscription(sub)"
                  class="m-1 p-button-sm"></button>
              </td>
            </tr>
          </ng-template>
        </p-table>
        <button class="btn btn-success px-4 mt-3" (click)="viewTab('allSubscriptions')">
          <b>All Subscriptions in details</b>
        </button>
      </p-tabPanel>
      <ng-container *ngIf="customerModels?.webSubscription">
        <p-tabPanel header="webSubscription ({{customerModels?.webSubscription}})">
          <p-table [value]="filter" *ngIf="customerModels?.webSubscription" [loading]="loadingTable"
            (onLazyLoad)="sort($event)">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center" pSortableColumn="invoice_no">invoice number
                  <p-sortIcon field="invoice_no"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="subscriptions_note">subscriptions plan
                  <p-sortIcon field="subscriptions_note"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="total_price">total price
                  <p-sortIcon field="total_price"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="user.first_name">name
                  <p-sortIcon field="user.first_name"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="created_at">created at
                  <p-sortIcon field="created_at"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="delivery_starting_day">Starting Day
                  <p-sortIcon field="delivery_starting_day"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="mode">Status
                  <p-sortIcon field="mode"></p-sortIcon>
                </th>
                <th class="text-center">Actions</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-sub>
              <tr [pSelectableRow]="sub">
                <td class="text-center">{{sub.invoice_no}}</td>
                <td class="text-center">{{sub.subscriptions_note}}</td>
                <td class="text-center">{{sub.total_price}}</td>
                <td class="text-center">{{sub.user?.first_name}}</td>
                <td class="text-center">{{sub.created_at | date}}</td>
                <td class="text-center">{{sub.delivery_starting_day}}</td>
                <td class="text-center">
                  <p-tag [severity]="getSeverity(sub.mode)" [value]="getMode(sub.mode)">
                  </p-tag>
                </td>
                <td class="text-center">
                  <button pButton type="button" icon="pi pi-eye" (click)="show_subscription(sub)"
                    class="m-1 p-button-sm"></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
          <button *ngIf="customerModels?.webSubscription" class="btn btn-success px-4 mt-3"
            (click)="viewTab('webSubscription')">
            <b>Web subscription in details</b>
          </button>
        </p-tabPanel>
      </ng-container>
      <ng-container *ngIf="customerModels?.paymentLink">
        <p-tabPanel header="paymentLink ({{customerModels?.paymentLink}})">
          <p-table [value]="filter" [loading]="loadingTable" (onLazyLoad)="sort($event)">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center" pSortableColumn="invoice_no">invoice number
                  <p-sortIcon field="invoice_no"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="subscriptions_note">subscriptions plan
                  <p-sortIcon field="subscriptions_note"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="total_price">total price
                  <p-sortIcon field="total_price"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="user.first_name">name
                  <p-sortIcon field="user.first_name"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="created_at">created at
                  <p-sortIcon field="created_at"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="delivery_starting_day">Starting Day
                  <p-sortIcon field="delivery_starting_day"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="mode">Status
                  <p-sortIcon field="mode"></p-sortIcon>
                </th>
                <th class="text-center">Actions</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-sub>
              <tr [pSelectableRow]="sub">
                <td class="text-center">{{sub.invoice_no}}</td>
                <td class="text-center">{{sub.subscriptions_note}}</td>
                <td class="text-center">{{sub.total_price}}</td>
                <td class="text-center">{{sub.user?.first_name}}</td>
                <td class="text-center">{{sub.created_at | date}}</td>
                <td class="text-center">{{sub.delivery_starting_day}}</td>
                <td class="text-center">
                  <p-tag [severity]="getSeverity(sub.mode)" [value]="getMode(sub.mode)">
                  </p-tag>
                </td>
                <td class="text-center">
                  <button pButton type="button" icon="pi pi-eye" (click)="show_subscription(sub)"
                    class="m-1 p-button-sm"></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
          <button class="btn btn-success px-4 mt-3" (click)="viewTab('paymentLink')">
            <b>Paymentlink in details</b>
          </button>
        </p-tabPanel>
      </ng-container>
      <ng-container *ngIf="customerModels?.mobileSubscription">
        <p-tabPanel header="mobileSubscription ({{customerModels?.mobileSubscription}})">
          <p-table [value]="filter" (onLazyLoad)="sort($event)" [loading]="loadingTable">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center" pSortableColumn="invoice_no">invoice number
                  <p-sortIcon field="invoice_no"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="subscriptions_note">subscriptions plan
                  <p-sortIcon field="subscriptions_note"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="total_price">total price
                  <p-sortIcon field="total_price"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="user.first_name">name
                  <p-sortIcon field="user.first_name"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="created_at">created at
                  <p-sortIcon field="created_at"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="delivery_starting_day">Starting Day
                  <p-sortIcon field="delivery_starting_day"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="mode">Status
                  <p-sortIcon field="mode"></p-sortIcon>
                </th>
                <th class="text-center">Actions</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-sub>
              <tr [pSelectableRow]="sub">
                <td class="text-center">{{sub.invoice_no}}</td>
                <td class="text-center">{{sub.subscriptions_note}}</td>
                <td class="text-center">{{sub.total_price}}</td>
                <td class="text-center">{{sub.user?.first_name}}</td>
                <td class="text-center">{{sub.created_at | date}}</td>
                <td class="text-center">{{sub.delivery_starting_day}}</td>
                <td class="text-center">
                  <p-tag [severity]="getSeverity(sub.mode)" [value]="getMode(sub.mode)">
                  </p-tag>
                </td>
                <td class="text-center">
                  <button pButton type="button" icon="pi pi-eye" (click)="show_subscription(sub)"
                    class="m-1 p-button-sm"></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
          <button class="btn btn-success px-4 mt-3" (click)="viewTab('mobileSubscription')">
            <b>Mobile subscription in details</b>
          </button>
        </p-tabPanel>
      </ng-container>
      <ng-container *ngIf="customerModels?.dataAnalytics">
        <p-tabPanel header="dataAnalytics ({{customerModels?.dataAnalytics}})">
          <p-table [value]="filter" (onLazyLoad)="sort($event)" [loading]="loadingTable">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center" pSortableColumn="date">Date
                  <p-sortIcon field="date"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="agent.name">Agent
                  <p-sortIcon field="agent.name"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="mobile">Customer Mobile
                  <p-sortIcon field="mobile"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="customer_name">Customer Name
                  <p-sortIcon field="customer_name"></p-sortIcon>
                </th>
                <th class="text-center">Actions</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-analysis>
              <tr [pSelectableRow]="analysis">
                <td class="text-center">{{analysis?.date}}</td>
                <td class="text-center">{{analysis?.agent?.name}}</td>
                <td class="text-center">{{analysis?.mobile}}</td>
                <td class="text-center">{{analysis?.customer_name}}</td>
                <td class="text-center">
                  <button pButton type="button" icon="pi pi-eye" (click)="show_dataAnalytics(analysis)"
                    class="m-1 p-button-sm"></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
          <button class="btn btn-success px-4 mt-3" (click)="viewTab('dataAnalytics')">
            <b>Data analytics in details</b>
          </button>
        </p-tabPanel>
      </ng-container>
      <ng-container *ngIf="customerModels?.Clinic">
        <p-tabPanel header="Clinic ({{customerModels?.Clinic}})">
          <p-table [value]="filter" (onLazyLoad)="sort($event)" [loading]="loadingTable">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center" pSortableColumn="invoice_no">invoice number
                  <p-sortIcon field="invoice_no"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="subscriptions_note">subscriptions plan
                  <p-sortIcon field="subscriptions_note"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="total_price">total price
                  <p-sortIcon field="total_price"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="user.first_name">name
                  <p-sortIcon field="user.first_name"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="created_at">created at
                  <p-sortIcon field="created_at"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="delivery_starting_day">Starting Day
                  <p-sortIcon field="delivery_starting_day"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="mode">Status
                  <p-sortIcon field="mode"></p-sortIcon>
                </th>
                <th class="text-center">Actions</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-sub>
              <tr [pSelectableRow]="sub">
                <td class="text-center">{{sub.invoice_no}}</td>
                <td class="text-center">{{sub.subscriptions_note}}</td>
                <td class="text-center">{{sub.total_price}}</td>
                <td class="text-center">{{sub.user?.first_name}}</td>
                <td class="text-center">{{sub.created_at | date}}</td>
                <td class="text-center">{{sub.delivery_starting_day}}</td>
                <td class="text-center">
                  <p-tag [severity]="getSeverity(sub.mode)" [value]="getMode(sub.mode)">
                  </p-tag>
                </td>
                <td class="text-center">
                  <button pButton type="button" icon="pi pi-eye" (click)="show_subscription(sub)"
                    class="m-1 p-button-sm"></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
          <button class="btn btn-success px-4 mt-3" (click)="viewTab('Clinic')">
            <b>Clinic in details</b>
          </button>
        </p-tabPanel>
      </ng-container>
      <ng-container *ngIf="customerModels?.Dislikes">
        <p-tabPanel header="Dislikes ({{customerModels?.Dislikes}})">
          <p-table [value]="filter" (onLazyLoad)="sort($event)" [loading]="loadingTable">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center" pSortableColumn="name">name
                  <p-sortIcon field="name"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="cid">cid
                  <p-sortIcon field="cid"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="branch">branch
                  <p-sortIcon field="branch"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="agent.name">agent
                  <p-sortIcon field="agent.name"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="sent_by">sent by
                  <p-sortIcon field="sent_by"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="dislike_meals">dislike meals
                  <p-sortIcon field="dislike_meals"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="reasons">reasons
                  <p-sortIcon field="reasons"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="created_at">created at
                  <p-sortIcon field="created_at"></p-sortIcon>
                </th>
                <th class="text-center">Actions </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-dislike>
              <tr [pSelectableRow]="dislike">
                <td class="text-center">{{dislike.name}}</td>
                <td class="text-center">{{dislike.cid}}</td>
                <td class="text-center">{{dislike.branch}}</td>
                <td class="text-center">{{dislike.agent?.name}}</td>
                <td class="text-center">{{dislike.sent_by}}</td>
                <td class="text-center">{{dislike.dislike_meals}}</td>
                <td class="text-center">{{dislike.reasons}}</td>
                <td class="text-center">{{dislike?.created_at | date}}</td>
                <td class="text-center">
                  <button pButton type="button" icon="pi pi-eye" (click)="show_Dislikes(dislike)"
                    class="m-1 p-button-sm"></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
          <button class="btn btn-success px-4 mt-3" (click)="viewTab('Dislikes')">
            <b>Dislikes in details</b>
          </button>
        </p-tabPanel>
      </ng-container>
      <ng-container *ngIf="customerModels?.issues">
        <p-tabPanel header="issues ({{customerModels?.issues}})">
          <p-table [value]="filter" (onLazyLoad)="sort($event)" [loading]="loadingTable">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center" pSortableColumn="agent_name">agent name
                  <p-sortIcon field="agent_name"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="branch">branch
                  <p-sortIcon field="branch"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="c_name">client name
                  <p-sortIcon field="c_name"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="cid">cid
                  <p-sortIcon field="cid"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="date">date
                  <p-sortIcon field="date"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="status">status
                  <p-sortIcon field="status"></p-sortIcon>
                </th>
                <th class="text-center">Actions </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-complaint>
              <tr [pSelectableRow]="complaint">
                <td class="text-center">{{complaint?.agent_name}}</td>
                <td class="text-center">{{complaint?.branch}}</td>
                <td class="text-center">{{complaint?.c_name}}</td>
                <td class="text-center">{{complaint?.cid}}</td>
                <td class="text-center">{{complaint?.date}}</td>
                <td class="text-center">{{complaint?.status}}</td>
                <td class="text-center">
                  <button pButton type="button" icon="pi pi-eye" (click)="show_issues(complaint)"
                    class="m-1 p-button-sm"></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
          <button class="btn btn-success px-4 mt-3" (click)="viewTab('issues')">
            <b>Issues in details</b>
          </button>
        </p-tabPanel>
      </ng-container>
      <ng-container *ngIf="customerModels?.refunds">
        <p-tabPanel header="refunds ({{customerModels?.refunds}})">
          <p-table [value]="filter" (onLazyLoad)="sort($event)" [loading]="loadingTable">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center" pSortableColumn="agent_name">agent name
                  <p-sortIcon field="agent_name"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="amount_paid">amount paid
                  <p-sortIcon field="amount_paid"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="branch">branch
                  <p-sortIcon field="branch"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="cid">cid
                  <p-sortIcon field="cid"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="created_at">created at
                  <p-sortIcon field="created_at"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="name">name
                  <p-sortIcon field="name"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="payment_method">payment method
                  <p-sortIcon field="payment_method"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="remaining_days">remaining days
                  <p-sortIcon field="remaining_days"></p-sortIcon>
                </th>
                <th class="text-center">Actions</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-refund>
              <tr [pSelectableRow]="refund">
                <td class="text-center">{{refund.agent_name}}</td>
                <td class="text-center">{{refund.amount_paid}}</td>
                <td class="text-center">{{refund.branch}}</td>
                <td class="text-center">{{refund.cid}}</td>
                <td class="text-center">{{refund.created_at | date}}</td>
                <td class="text-center">{{refund.name}}</td>
                <td class="text-center">{{refund.payment_method}}</td>
                <td class="text-center">{{refund.remaining_days}}</td>
                <td class="text-center">
                  <button pButton type="button" icon="pi pi-eye" (click)="show_refunds(refund)"
                    class="m-1 p-button-sm"></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
          <button class="btn btn-success px-4 mt-3" (click)="viewTab('refunds')">
            <b>Refunds in details</b>
          </button>
        </p-tabPanel>
      </ng-container>
      <ng-container *ngIf="customerModels?.calls">
        <p-tabPanel header="calls ({{customerModels?.calls}})">
          <p-table [value]="filter" (onLazyLoad)="sort($event)" [loading]="loadingTable">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center" pSortableColumn="cid">cid
                  <p-sortIcon field="cid"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="subscription_id">remaining days
                  <p-sortIcon field="subscription_id"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="branch">branch
                  <p-sortIcon field="branch"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="customer_name">customer name
                  <p-sortIcon field="customer_name"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="plan">plan
                  <p-sortIcon field="plan"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="date">date
                  <p-sortIcon field="date"></p-sortIcon>
                </th>
                <th class="text-center">Actions </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-call>
              <tr [pSelectableRow]="call">
                <td class="text-center">{{call.cid}}</td>
                <td class="text-center">{{call.subscription_id}}</td>
                <td class="text-center">{{call.branch}}</td>
                <td class="text-center">{{call.customer_name}}</td>
                <td class="text-center">{{call.plan}}</td>
                <td class="text-center">{{call.date}}</td>
                <td class="text-center">
                  <button pButton type="button" icon="pi pi-eye" (click)="show_calls(call)"
                    class="m-1 p-button-sm"></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
          <button class="btn btn-success px-4 mt-3" (click)="viewTab('calls')">
            <b>Calls in details</b>
          </button>
        </p-tabPanel>
      </ng-container>
      <ng-container *ngIf="customerModels?.leads">
        <p-tabPanel header="leads ({{customerModels?.leads}})">
          <p-table [value]="filter" (onLazyLoad)="sort($event)" [loading]="loadingTable">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center" pSortableColumn="created_at">created at
                  <p-sortIcon field="created_at"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="customer_name">customer name
                  <p-sortIcon field="customer_name"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="status">status
                  <p-sortIcon field="status"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="platforms">platforms
                  <p-sortIcon field="platforms"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="type">type
                  <p-sortIcon field="type"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="user_created.name">Created By
                  <p-sortIcon field="user_created.name"></p-sortIcon>
                </th>
                <th class="text-center">Actions </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-lead>
              <tr [pSelectableRow]="lead">
                <td class="text-center">{{lead?.created_at | date}}</td>
                <td class="text-center">{{lead?.customer_name}}</td>
                <td class="text-center">{{lead?.status}}</td>
                <td class="text-center">{{lead?.platforms}}</td>
                <td class="text-center">{{lead?.type}}</td>
                <td class="text-center">{{lead?.user_created?.name}}</td>
                <td class="text-center">
                  <button pButton type="button" icon="pi pi-eye" (click)="show_leads(lead)"
                    class="m-1 p-button-sm"></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
          <button class="btn btn-success px-4 mt-3" (click)="viewTab('leads')">
            <b>Leads in details</b>
          </button>
        </p-tabPanel>
      </ng-container>
      <ng-container *ngIf="customerModels?.targets">
        <p-tabPanel header="targets ({{customerModels?.targets}})">
          <p-table [value]="filter" (onLazyLoad)="sort($event)" [loading]="loadingTable">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center" pSortableColumn="agent.name">agent name
                  <p-sortIcon field="agent.name"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="date">date
                  <p-sortIcon field="date"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="customer_type">customer type
                  <p-sortIcon field="customer_type"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="paid_by">paid by
                  <p-sortIcon field="paid_by"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="invoice_number">invoice number
                  <p-sortIcon field="invoice_number"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="client_name">client name
                  <p-sortIcon field="client_name"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="amount_paid">amount paid
                  <p-sortIcon field="amount_paid"></p-sortIcon>
                </th>
                <th class="text-center">Actions </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-agent>
              <tr [pSelectableRow]="agent">
                <td class="text-center">{{agent?.agent?.name}}</td>
                <td class="text-center">{{agent?.date}}</td>
                <td class="text-center">{{agent?.customer_type}}</td>
                <td class="text-center">{{agent?.paid_by}}</td>
                <td class="text-center">{{agent?.invoice_number}}</td>
                <td class="text-center">{{agent?.client_name}}</td>
                <td class="text-center">{{agent?.amount_paid}}</td>
                <td class="text-center">
                  <button pButton type="button" icon="pi pi-eye" (click)="show_targets(agent)"
                    class="m-1 p-button-sm"></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
          <button class="btn btn-success px-4 mt-3" (click)="viewTab('targets')">
            <b>Targets in details</b>
          </button>
        </p-tabPanel>
      </ng-container>
      <ng-container *ngIf="customerModels?.sticky_notes">
        <p-tabPanel header="sticky_notes ({{customerModels?.sticky_notes}})">
          <p-table [value]="filter" (onLazyLoad)="sort($event)" [loading]="loadingTable">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center" pSortableColumn="agent.name">agent name
                  <p-sortIcon field="agent.name"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="date">date
                  <p-sortIcon field="date"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="note">note
                  <p-sortIcon field="note"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="inquiry">inquiry
                  <p-sortIcon field="inquiry"></p-sortIcon>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-row>
              <tr [pSelectableRow]="row">
                <td class="text-center">{{row?.agent?.name}}</td>
                <td class="text-center">{{row?.created_at | date:'M/d/yyyy'}}</td>
                <td class="text-center">{{row?.note}}</td>
                <td class="text-center">{{row?.inquiry}}</td>
              </tr>
            </ng-template>
          </p-table>
          <button class="btn btn-success px-4 mt-3" (click)="viewTab('sticky_notes')">
            <b>Notes in details</b>
          </button>
        </p-tabPanel>
      </ng-container>
      <ng-container *ngIf="system.length">
        <p-tabPanel header="systemSubscription ({{system.length}})">
          <p-table [value]="filter" (onLazyLoad)="sort($event)">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center">#</th>
                <th class="text-center" pSortableColumn="cid">CID
                  <p-sortIcon field="cid"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="remainingDays">Remaining Days
                  <p-sortIcon field="remainingDays"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="planTitle">Plan Title
                  <p-sortIcon field="planTitle"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="status">Status
                  <p-sortIcon field="status"></p-sortIcon>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-system let-i="rowIndex">
              <tr [pSelectableRow]="system">
                <td class="text-center">{{i+1}}</td>
                <td class="text-center">{{system?.cid}}</td>
                <td class="text-center">{{system?.remainingDays}}</td>
                <td class="text-center">{{system?.planTitle}}</td>
                <td class="text-center">{{system?.status}}</td>
              </tr>
            </ng-template>
          </p-table>
        </p-tabPanel>
      </ng-container>
      <ng-container *ngIf="pickup?.length">
        <p-tabPanel header="systemPickup ({{pickup.length}})">
          <p-table [value]="filter" (onLazyLoad)="sort($event)">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center">#</th>
                <th class="text-center" pSortableColumn="invoiceBranchName">Invoice Branch
                  <p-sortIcon field="invoiceBranchName"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="remainingMeals">Remaining Meals
                  <p-sortIcon field="remainingMeals"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="remainingSnacks">Remaining Snacks
                  <p-sortIcon field="remainingSnacks"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="planName">Plan Name
                  <p-sortIcon field="planName"></p-sortIcon>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-pickup let-i="rowIndex">
              <tr [pSelectableRow]="pickup">
                <td class="text-center">{{i+1}}</td>
                <td class="text-center">{{pickup?.invoiceBranchName}}</td>
                <td class="text-center">{{pickup?.remainingMeals}}</td>
                <td class="text-center">{{pickup?.remainingSnacks}}</td>
                <td class="text-center">{{pickup?.planName}}</td>
              </tr>
            </ng-template>
          </p-table>
        </p-tabPanel>
      </ng-container>
      <ng-container *ngIf="CHSubscriptions">
        <p-tabPanel header="CH_Subscriptions">
          <div class="card">
            <div class="card-header">
              <div class="text-muted d-flex align-items-center">
                <h6 class="m-0" style="width: 600px;">Title</h6>
                <h6 class="m-0">Description</h6>
              </div>
            </div>
            <div class="card-body">
              <div class="table-responsive overflow-auto">
                <table class="table">
                  <tbody>
                    <tr>
                      <td>
                        customer Id
                      </td>
                      <td>
                        {{CHSubscriptions?.customerId}}
                      </td>
                    </tr>
                    <tr>
                      <td>
                        customer Name
                      </td>
                      <td>
                        {{CHSubscriptions?.customerName}}
                      </td>
                    </tr>
                    <tr>
                      <td>
                        email
                      </td>
                      <td>
                        {{CHSubscriptions?.email}}
                      </td>
                    </tr>
                    <tr>
                      <td>
                        phone
                      </td>
                      <td>
                        {{CHSubscriptions?.phone}}
                      </td>
                    </tr>
                    <tr>
                      <td>
                        adress
                      </td>
                      <td>
                        {{CHSubscriptions?.adress}}
                      </td>
                    </tr>
                    <tr>
                      <td>
                        weight
                      </td>
                      <td>
                        {{CHSubscriptions?.weight}}
                      </td>
                    </tr>
                    <tr>
                      <td>
                        height
                      </td>
                      <td>
                        {{CHSubscriptions?.height}}
                      </td>
                    </tr>
                    <tr>
                      <td>
                        customer Category
                      </td>
                      <td>
                        {{CHSubscriptions?.customerCategory}}
                      </td>
                    </tr>
                    <tr>
                      <td>
                        register Type
                      </td>
                      <td>
                        {{CHSubscriptions?.regType}}
                      </td>
                    </tr>

                    <tr>
                      <td>
                        birth Date
                      </td>
                      <td>
                        {{CHSubscriptions?.birthDate | date}}
                      </td>
                    </tr>

                    <tr>
                      <td>
                        driver
                      </td>
                      <td>
                        {{CHSubscriptions?.driver}}
                      </td>
                    </tr>

                    <tr>
                      <td>
                        branch
                      </td>
                      <td>
                        {{CHSubscriptions?.branch}}
                      </td>
                    </tr>

                    <tr>
                      <td>
                        customer Adress
                      </td>
                      <td>
                        <button pButton type="button" icon="pi pi-eye"
                          (click)="showCustomerAdress = !showCustomerAdress"
                          class="m-1 p-button-sm p-button-primary"></button>
                      </td>
                    </tr>

                    <tr>
                      <td>
                        customer Phones
                      </td>
                      <td>
                        <button pButton type="button" icon="pi pi-eye"
                          (click)="showCustomerPhones = !showCustomerPhones"
                          class="m-1 p-button-sm p-button-primary"></button>
                      </td>
                    </tr>

                    <tr>
                      <td>
                        subscriptions
                      </td>
                      <td>
                        <button pButton type="button" icon="pi pi-eye" (click)="showCustomerSub = !showCustomerSub"
                          class="m-1 p-button-sm p-button-primary"></button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <p-table [value]="CHSubscriptions?.customerAdress" *ngIf="showCustomerAdress">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center">#</th>
                <th class="text-center">Address</th>
                <th class="text-center">Area</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-ch let-i="rowIndex">
              <tr>
                <td class="text-center">{{i+1}}</td>
                <td class="text-center">{{ch?.adress}}</td>
                <td class="text-center">{{ch?.area?.name}}</td>
              </tr>
            </ng-template>
          </p-table>

          <p-table [value]="CHSubscriptions?.customerPhones" *ngIf="showCustomerPhones">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center">#</th>
                <th class="text-center">Phone</th>
                <th class="text-center">Type</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-ch let-i="rowIndex">
              <tr>
                <td class="text-center">{{i+1}}</td>
                <td class="text-center">{{ch?.phone}}</td>
                <td class="text-center">{{ch?.phoneType}}</td>
              </tr>
            </ng-template>
          </p-table>

          <p-table [value]="CHSubscriptions?.subscriptions" *ngIf="showCustomerSub">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center">#</th>
                <th class="text-center">branchName</th>
                <th class="text-center">driverName</th>
                <th class="text-center">planName</th>
                <th class="text-center">planTitle</th>
                <th class="text-center">remainingDays</th>
                <th class="text-center">startDate</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-ch let-i="rowIndex">
              <tr>
                <td class="text-center">{{i+1}}</td>
                <td class="text-center">{{ch?.branchName}}</td>
                <td class="text-center">{{ch?.driverName}}</td>
                <td class="text-center">{{ch?.planName}}</td>
                <td class="text-center">{{ch?.planTitle}}</td>
                <td class="text-center">{{ch?.remainingDays}}</td>
                <td class="text-center">{{ch?.startDate | date}}</td>
              </tr>
            </ng-template>
          </p-table>
        </p-tabPanel>
      </ng-container>
      <ng-container *ngIf="callGear.length">
        <p-tabPanel header="callGear ({{callGear.length}})">
          <p-table [value]="filter" (onLazyLoad)="sort($event)" [loading]="loadingTable">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center" pSortableColumn="total_duration">Total Duration
                  <p-sortIcon field="total_duration"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="start_time">Start Time
                  <p-sortIcon field="start_time"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="direction">Direction
                  <p-sortIcon field="direction"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="is_lost">is_lost
                  <p-sortIcon field="is_lost"></p-sortIcon>
                </th>
                <th class="text-center">Actions </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-callGear>
              <tr [pSelectableRow]="callGear">
                <td class="text-center">{{callGear?.total_duration}}s</td>
                <td class="text-center">{{callGear?.start_time| date: 'dd/MM/yyyy hh:mm a'}}</td>
                <td class="text-center">{{callGear?.direction}}</td>
                <td class="text-center">
                  <p-tag [severity]="getSeverity(callGear.is_lost ? 0 : 2)"
                    [value]="callGear.is_lost ? 'Missed' :'Done'">
                  </p-tag>
                </td>
                <td class="text-center">
                  <button *ngIf="callGear?.employees" pButton type="button" icon="pi pi-users"
                    (click)="show_callEmp(callGear)" class="m-1 p-button-sm"></button>
                  <button *ngIf="callGear?.call_records?.length" pButton type="button" icon="pi pi-play"
                    (click)="show_callGear(callGear)" class="m-1 p-button-sm p-button-help"></button>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </p-tabPanel>
      </ng-container>
      <ng-container>
        <p-tabPanel header="EXPORT">
          <p-table [value]="exportModels">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center">Model</th>
                <th class="text-center">Download Excel File</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-model>
              <tr>
                <td class="text-center">{{model.model}}</td>
                <td class="text-center">
                  <a [href]="model.value" target="_blank" rel="noopener noreferrer">Download {{model.model}}</a>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </p-tabPanel>
      </ng-container>
    </p-tabView>
  </div>
</p-dialog>

<p-dialog [(visible)]="phoneModal" [modal]="true" [style]="{width: '50vw'}" [draggable]="false" [resizable]="false">
  <div class="row">
    <div class="col-12">
      <div class="form-group">
        <label for="">Customer Phone</label>
        <input type="text" class="w-100 py-2 my-2" pInputText placeholder="Enter Customer Phone" maxlength="10"
          (keydown.enter)="getCustomerModels(CID_INPUT)"
          oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\..*/g, '$1');" #CID_INPUT>
        <div class="text-end">
          <button class="btn btn-success px-4" (click)="getCustomerModels(CID_INPUT)">
            <b>Get Customer Info</b>
          </button>
        </div>
      </div>
    </div>
  </div>
</p-dialog>

<p-dialog header="Please upload a file included all properties" [(visible)]="uploadModal" [modal]="true"
  [style]="{width: '50vw'}" [draggable]="false" [resizable]="false">

  <ng-template pTemplate="footer">
    <div class="upload-btn-wrapper mx-2">
      <a class="btn btn-primary" target="_blank" download href="https://api.lowcalories.ae/samples/mobiles.csv">Download
        Sample</a>
    </div>
    <div class="upload-btn-wrapper">
      <button class="btn btn-primary">Upload a file</button>
      <input type="file" name="myfile" (change)="onFileSelected($event)" />
    </div>
  </ng-template>
</p-dialog>

<div class="loader-container" *ngIf="isLoading">
  <div class="i-loader-inf-horizontal-container">
    <div class="i-loader-inf-horizontal"></div>
    <div class="pt-8px">
      <span>Processing data</span>
    </div>
  </div>
</div>

<p-dialog header="Details Modal" [(visible)]="targetsDetailsModal" [modal]="true" [style]="{width: '50vw'}"
  [draggable]="true" [resizable]="true">
  <div class="card">
    <div class="card-header">
      <div class="text-muted d-flex align-items-center">
        <h6 class="m-0" style="width: 200px;">Title</h6>
        <h6 class="m-0">Description</h6>
      </div>
    </div>
    <div class="card-body">
      <div class="table-responsive overflow-auto">
        <table class="table">

          <tbody>
            <tr>
              <td>Date</td>
              <td>{{current_targets?.date | date}}</td>
            </tr>
            <tr>
              <td>agent</td>
              <td>{{current_targets?.agent?.name}}</td>
            </tr>
            <tr>
              <td>team</td>
              <td>{{current_targets?.team}}</td>
            </tr>
            <tr>
              <td>client number</td>
              <td>{{current_targets?.client_number}}</td>
            </tr>
            <tr>
              <td>client cid</td>
              <td>{{current_targets?.client_cid}}</td>
            </tr>
            <tr>
              <td>branch</td>
              <td>{{current_targets?.branch}}</td>
            </tr>
            <tr>
              <td>customer type</td>
              <td>{{current_targets?.customer_type}}</td>
            </tr>
            <tr>
              <td>paid by</td>
              <td>{{current_targets?.paid_by}}</td>
            </tr>
            <tr>
              <td>status</td>
              <td>{{current_targets?.status}}</td>
            </tr>
            <tr>
              <td>invoice number</td>
              <td>{{current_targets?.invoice_number}}</td>
            </tr>
            <tr>
              <td>type</td>
              <td>{{current_targets?.type}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</p-dialog>

<p-dialog header="Details Modal" [(visible)]="dataAnalyticsDetailsModal" [modal]="true" [style]="{width: '50vw'}"
  [draggable]="true" [resizable]="true">
  <div class="card">
    <div class="card-header">
      <div class="text-muted d-flex align-items-center">
        <h6 class="m-0" style="width: 200px;">Title</h6>
        <h6 class="m-0">Description</h6>
      </div>
    </div>
    <div class="card-body">
      <div class="table-responsive overflow-auto">
        <table class="table">
          <tbody>
            <tr *ngIf="current_dataAnalytics?.date">
              <td width="200">Date</td>
              <td>{{ current_dataAnalytics?.date }}</td>
            </tr>
            <tr *ngIf="current_dataAnalytics?.agent">
              <td width="200">Agent Name</td>
              <td>{{ current_dataAnalytics?.agent.name }}</td>
            </tr>
            <tr *ngIf="current_dataAnalytics?.mobile">
              <td width="200">Customer Mobile</td>
              <td>{{ current_dataAnalytics?.mobile }}</td>
            </tr>
            <tr *ngIf="current_dataAnalytics?.customer_name">
              <td width="200">Customer Name</td>
              <td>{{ current_dataAnalytics?.customer_name }}</td>
            </tr>
            <tr *ngIf="current_dataAnalytics?.customer_gender">
              <td width="200">Customer Gender</td>
              <td>{{ current_dataAnalytics?.customer_gender }}</td>
            </tr>
            <tr *ngIf="current_dataAnalytics?.emirate">
              <td width="200">Emirate</td>
              <td>{{ current_dataAnalytics?.emirate?.en_name }}</td>
            </tr>
            <tr *ngIf="current_dataAnalytics?.platform">
              <td width="200">Platform</td>
              <td>{{ current_dataAnalytics?.platform }}</td>
            </tr>
            <tr *ngIf="current_dataAnalytics?.platform_option">
              <td width="200">Platform Option</td>
              <td>{{ current_dataAnalytics?.platform_option }}</td>
            </tr>
            <tr *ngIf="current_dataAnalytics?.customer_status">
              <td width="200">Customer Status</td>
              <td>{{ current_dataAnalytics?.customer_status }}</td>
            </tr>
            <tr *ngIf="current_dataAnalytics?.concern">
              <td width="200">Concern</td>
              <td>{{ current_dataAnalytics?.concern }}</td>
            </tr>
            <tr *ngIf="current_dataAnalytics?.mode">
              <td width="200">Mode</td>
              <td>{{ current_dataAnalytics?.mode }}</td>
            </tr>
            <tr *ngIf="current_dataAnalytics?.mode_reason">
              <td width="200">Mode Reason</td>
              <td>{{ current_dataAnalytics?.mode_reason }}</td>
            </tr>
            <tr *ngIf="current_dataAnalytics?.ask_for">
              <td width="200">Ask For</td>
              <td>{{ current_dataAnalytics?.ask_for }}</td>
            </tr>
            <tr *ngIf="current_dataAnalytics?.ask_for_options">
              <td width="200">Ask For Options</td>
              <td>{{ current_dataAnalytics?.ask_for_options }}</td>
            </tr>
            <tr *ngIf="current_dataAnalytics?.actions">
              <td width="200">Actions</td>
              <td>{{ current_dataAnalytics?.actions }}</td>
            </tr>
            <tr *ngIf="current_dataAnalytics?.notes">
              <td width="200">Notes</td>
              <td>{{ current_dataAnalytics?.notes }}</td>
            </tr>
            <tr *ngIf="current_dataAnalytics?.notes">
              <td width="200">Notes</td>
              <td>{{ current_dataAnalytics?.notes }}</td>
            </tr>
            <tr *ngFor="let item of current_dataAnalytics?.data_options">
              <td [width]="200">
                {{ item.label }}
              </td>
              <td>{{ item.name }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</p-dialog>

<p-dialog header="Details Modal" [(visible)]="callsDetailsModal" [modal]="true" [style]="{width: '50vw'}"
  [draggable]="true" [resizable]="true">
  <div class="card">
    <div class="card-header">
      <div class="text-muted d-flex align-items-center">
        <h6 class="m-0" style="width: 200px;">Title</h6>
        <h6 class="m-0">Description</h6>
      </div>
    </div>
    <div class="card-body">
      <div class="table-responsive overflow-auto">
        <table class="table">

          <tbody>
            <tr>
              <td>Cid</td>
              <td>{{current_calls?.cid}}</td>
            </tr>
            <tr>
              <td>remaining days</td>
              <td>{{current_calls?.subscription_id}}</td>
            </tr>
            <tr>
              <td>branch</td>
              <td>{{current_calls?.branch}}</td>
            </tr>
            <tr>
              <td>customer name</td>
              <td>{{current_calls?.customer_name}}</td>
            </tr>
            <tr>
              <td>customer phone</td>
              <td>{{current_calls?.customer_mobile}}</td>
            </tr>
            <tr>
              <td>customer mobile</td>
              <td>{{current_calls?.customer_phone}}</td>
            </tr>
            <tr>
              <td>plan</td>
              <td>{{current_calls?.plan}}</td>
            </tr>
            <tr>
              <td>date</td>
              <td>{{current_calls?.date}}</td>
            </tr>
            <tr>
              <td>note</td>
              <td>{{current_calls?.note}}</td>
            </tr>
            <tr>
              <td>created at</td>
              <td>{{current_calls?.created_at|date}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</p-dialog>

<p-dialog header="Details Modal" [(visible)]="issuesDetailsModal" [modal]="true" [style]="{width: '50vw'}"
  [draggable]="true" [resizable]="true">
  <div class="card">
    <div class="card-header">
      <div class="text-muted d-flex align-items-center">
        <h6 class="m-0" style="width: 200px;">Title</h6>
        <h6 class="m-0">Description</h6>
      </div>
    </div>
    <div class="card-body">
      <div class="table-responsive overflow-auto">
        <table class="table">

          <tbody>
            <tr>
              <td>Date</td>
              <td>{{current_issues?.date | date}}</td>
            </tr>
            <tr>
              <td>client number</td>
              <td>{{current_issues?.c_mobile}}</td>
            </tr>
            <tr>
              <td>client cid</td>
              <td>{{current_issues?.cid}}</td>
            </tr>
            <tr>
              <td>client name</td>
              <td>{{current_issues?.c_name}}</td>
            </tr>
            <tr>
              <td>agent</td>
              <td>{{current_issues?.agent_name}}</td>
            </tr>
            <tr>
              <td>branch</td>
              <td>{{current_issues?.branch}}</td>
            </tr>
            <tr>
              <td>action</td>
              <td>{{current_issues?.action}}</td>
            </tr>
            <tr>
              <td>status</td>
              <td>{{current_issues?.status}}</td>
            </tr>
            <tr>
              <td>issue details</td>
              <td>{{current_issues?.issue_details}}</td>
            </tr>
            <tr>
              <td>feedback type</td>
              <td>{{current_issues?.feedback_type}}</td>
            </tr>
            <tr>
              <td>order type</td>
              <td>{{current_issues?.order_type}}</td>
            </tr>
            <tr>
              <td>issue category</td>
              <td>{{current_issues?.issue_category}}</td>
            </tr>
            <tr *ngIf="current_issues?.reason">
              <td>reason</td>
              <td>{{current_issues?.reason}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</p-dialog>

<p-dialog header="Details Modal" [(visible)]="DislikesDetailsModal" [modal]="true" [style]="{width: '50vw'}"
  [draggable]="true" [resizable]="true">
  <div class="card">
    <div class="card-header">
      <div class="text-muted d-flex align-items-center">
        <h6 class="m-0" style="width: 200px;">Title</h6>
        <h6 class="m-0">Description</h6>
      </div>
    </div>
    <div class="card-body">
      <div class="table-responsive overflow-auto">
        <table class="table">

          <tbody>
            <tr>
              <td>Created By</td>
              <td>{{current_Dislikes?.agent.name}}</td>
            </tr>
            <tr>
              <td>Name</td>
              <td>{{current_Dislikes?.name}}</td>
            </tr>
            <tr>
              <td>Email</td>
              <td>{{current_Dislikes?.email}}</td>
            </tr>
            <tr>
              <td>Mobile</td>
              <td>
                <span *ngFor="let mob of current_Dislikes?.mobile;let i = index">
                  <span *ngIf="mob">{{mob}}<br></span>
                </span>
              </td>
            </tr>
            <tr>
              <td>Sent by</td>
              <td>{{current_Dislikes?.sent_by}}</td>
            </tr>
            <tr>
              <td>Branch</td>
              <td>{{current_Dislikes?.branch}}</td>
            </tr>
            <tr>
              <td>Date Issue</td>
              <td>{{current_Dislikes?.created_at | date}}</td>
            </tr>
            <tr>
              <td>Reasons</td>
              <td>
                <span *ngFor="let reason of current_Dislikes?.reasons;let i = index">
                  <i class="fas fa-info-circle mx-2 text-muted"></i> {{reason}} <br>
                </span>
              </td>
            </tr>
            <tr>
              <td>Dislike Meals</td>
              <td>
                <span *ngFor="let meal of current_Dislikes?.dislike_meals;let i = index">
                  <i class="fas fa-utensils mx-2 text-muted"></i> {{meal}} <br>
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</p-dialog>

<p-dialog header="Details Modal" [(visible)]="refundsDetailsModal" [modal]="true" [style]="{width: '50vw'}"
  [draggable]="true" [resizable]="true">
  <div class="card">
    <div class="card-header">
      <div class="text-muted d-flex align-items-center">
        <h6 class="m-0" style="width: 200px;">Title</h6>
        <h6 class="m-0">Description</h6>
      </div>
    </div>
    <div class="card-body">
      <div class="table-responsive overflow-auto">
        <table class="table">

          <tbody>
            <tr>
              <td>Date</td>
              <td>{{current_refunds?.created_at | date}}</td>
            </tr>
            <tr>
              <td>agent name</td>
              <td>{{current_refunds?.agent_name}}</td>
            </tr>
            <tr>
              <td>name</td>
              <td>{{current_refunds?.name}}</td>
            </tr>
            <tr>
              <td>email</td>
              <td>{{current_refunds?.email}}</td>
            </tr>
            <tr>
              <td>mobile</td>
              <td>{{current_refunds?.mobile}}</td>
            </tr>
            <tr>
              <td>branch</td>
              <td>{{current_refunds?.branch}}</td>
            </tr>
            <tr>
              <td>delivery branch</td>
              <td>{{current_refunds?.delivery_branch}}</td>
            </tr>
            <tr>
              <td>subscription plan</td>
              <td>{{current_refunds?.subscription_plan}}</td>
            </tr>
            <tr>
              <td>remaining days</td>
              <td>{{current_refunds?.remaining_days}}</td>
            </tr>
            <tr>
              <td>payment method</td>
              <td>{{current_refunds?.payment_method}}</td>
            </tr>
            <tr>
              <td>cid</td>
              <td>{{current_refunds?.cid}}</td>
            </tr>
            <tr>
              <td>address</td>
              <td>{{current_refunds?.address}}</td>
            </tr>
            <tr>
              <td>bank name</td>
              <td>{{current_refunds?.bank_name}}</td>
            </tr>
            <tr>
              <td>amount paid</td>
              <td>{{current_refunds?.amount_paid}}</td>
            </tr>
            <tr>
              <td>reason</td>
              <td>{{current_refunds?.reason}}</td>
            </tr>
            <tr>
              <td>notes</td>
              <td>{{current_refunds?.notes}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</p-dialog>

<p-dialog header="Details Modal" [(visible)]="leadsDetailsModal" [modal]="true" [style]="{width: '50vw'}"
  [draggable]="true" [resizable]="true">
  <div class="card">
    <div class="card-header">
      <div class="text-muted d-flex align-items-center">
        <h6 class="m-0" style="width: 200px;">Title</h6>
        <h6 class="m-0">Description</h6>
      </div>
    </div>
    <div class="card-body">
      <div class="table-responsive overflow-auto">
        <table class="table">

          <tbody>
            <tr>
              <td>Date</td>
              <td>{{current_leads?.created_at | date}}</td>
            </tr>
            <tr>
              <td>Created By</td>
              <td>{{current_leads?.user_created.name}}</td>
            </tr>
            <tr>
              <td>Name</td>
              <td>{{current_leads?.customer_name}}</td>
            </tr>
            <tr>
              <td>Email</td>
              <td>{{current_leads?.customer_email}}</td>
            </tr>
            <tr>
              <td>Mobile</td>
              <td>{{current_leads?.customer_mobile}}</td>
            </tr>
            <tr>
              <td>Platform</td>
              <td>{{current_leads?.platforms}}</td>
            </tr>
            <tr>
              <td>Lost Reason</td>
              <td>{{current_leads?.lost_reasons}}</td>
            </tr>
            <tr>
              <td>Status</td>
              <td>{{current_leads?.status}}</td>
            </tr>
            <tr>
              <td>Type</td>
              <td>{{current_leads?.type}}</td>
            </tr>
            <tr>
              <td>Details</td>
              <td>{{current_leads?.notes}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</p-dialog>

<p-dialog header="Details Modal" [(visible)]="subscriptionDetailsModal" [modal]="true" [style]="{width: '50vw'}"
  [draggable]="true" [resizable]="true">
  <div id="invoice">
    <div class="invoice overflow-auto" *ngIf="current_subscription">
      <div>
        <main class="d-flex flex-wraps">
          <table cellspacing="0" cellpadding="0" style="text-align: center">
            <thead>
              <tr>
                <th>#</th>
                <th colspan="6"><i>Subscription Deatils</i></th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="no">01</td>
                <td class="text-center">
                  <h3>INVOICE NO</h3>
                </td>
                <td colspan="6" class="text-right" style="padding-right: 50px;">
                  <span>{{ current_subscription?.invoice_no }}</span>
                </td>
              </tr>
              <tr>
                <td class="no">02</td>
                <td class="text-center">
                  <h3>PROGRAM</h3>
                </td>
                <td style="font-size: 14px;">
                  <span> {{current_subscription?.subscriptions_note.split('-')[1]}}
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    {{current_subscription?.full_plan_name.split('-')[0] + ""}}
                    &#160;&#160;&#160;&#160;&#160;
                    {{current_subscription?.full_plan_name.split('-')[2] + ""}}
                    &#160;&#160;&#160;&#160;&#160;
                    {{current_subscription?.full_plan_name.split('-')[3]}}</span>
                </td>
              </tr>
              <tr>
                <td class="no">03</td>
                <td class="text-center">
                  <h3>PLAN TITLE</h3>
                </td>
                <td colspan="6" class="text-right" style="padding-right: 50px;font-size: 15px;">
                  <span>{{ current_subscription?.subscriptions_note }}</span>
                </td>
              </tr>
              <tr>
                <td class="no">04</td>
                <td class="text-center">
                  <h3>MEAL TYPES</h3>
                </td>
                <td colspan="6" class="text-right" style="padding-right: 50px;font-size: 15px;">
                  <span>{{ current_subscription?.dislike }}</span>
                </td>
              </tr>
              <tr>
                <td class="no">05</td>
                <td class="text-center">
                  <h3>Need Cutlery?</h3>
                </td>
                <td colspan="6" class="text-right" style="padding-right: 50px;font-size: 15px;">
                  <span>{{ current_subscription?.cutlery == 'checked' ? "yes" : "no" }}</span>
                </td>
              </tr>
              <tr>
                <td class="no">06</td>
                <td class="text-center">
                  <h3>Dislike Meals</h3>
                </td>
                <td colspan="6" class="text-right" style="padding-right: 50px;font-size: 15px;">
                  <span>{{ current_subscription?.dis_like_user }}</span>
                </td>
              </tr>
              <tr>
                <td class="no">07</td>
                <td class="text-center">
                  <h3>Payment Type</h3>
                </td>
                <td colspan="6" class="text-right" style="padding-right: 50px;font-size: 15px;">
                  <div *ngIf="current_subscription?.sub_from.toLowerCase() == 'branch'">
                    <div [ngSwitch]="current_subscription?.program_id">
                      <span *ngSwitchCase="51">
                        Branch Cash
                      </span>
                      <span *ngSwitchCase="52">
                        Branch Credit Card
                      </span>
                      <span *ngSwitchCase="53">
                        Branch EXCHANGE
                      </span>
                      <span *ngSwitchDefault>
                        {{current_subscription?.sub_from}}
                      </span>
                    </div>
                  </div>
                  <div
                    *ngIf="current_subscription?.sub_from.toLowerCase() == 'web' || current_subscription?.sub_from.toLowerCase() == 'mobile'">
                    Online
                  </div>
                  <div *ngIf="current_subscription?.sub_from.toLowerCase() == 'payment link'">
                    Payment Link
                  </div>
                  <div *ngIf="current_subscription?.sub_from.toLowerCase() == 'exchange'">
                    Payment Link Exchange
                  </div>
                  <div *ngIf="current_subscription?.program_id == 60 || current_subscription?.program_id == 61">
                    NUTRAION ONLINE
                  </div>
                </td>
              </tr>
              <tr *ngIf="current_subscription?.agent">
                <td class="no">08</td>
                <td class="text-center">
                  <h3>Agent</h3>
                </td>
                <td colspan="6" class="text-right" style="padding-right: 50px;font-size: 15px;">
                  <span>{{ current_subscription?.agent.name }}</span>
                </td>
              </tr>
              <tr *ngIf="current_subscription?.program_id == 50 || current_subscription?.program_id < 15">
                <td class="no">{{current_subscription?.agent? '09': '08'}}</td>
                <td class="text-center">
                  <h3>Confirmed Terms</h3>
                </td>
                <td colspan="6" class="text-right" style="padding-right: 50px;font-size: 15px;">
                  <span>YES</span>
                </td>
              </tr>
            </tbody>
          </table>

          <table cellspacing="0" cellpadding="0" style="text-align: center">
            <thead>
              <tr>
                <th>#</th>
                <th colspan="4"><i>Personal Deatils</i></th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="no">01</td>
                <td class="text-center">
                  <h3>First Name</h3>
                </td>
                <td>
                  <span>{{ current_subscription?.user.first_name }}</span>
                </td>
                <td class="text-center">
                  <h3>Last Name</h3>
                </td>
                <td>
                  <span>{{ current_subscription?.user.last_name }}</span>
                </td>
              </tr>
              <tr>
                <td class="no">02</td>
                <td class="text-center">
                  <h3>Gender</h3>
                </td>
                <td>
                  <span>{{ current_subscription?.user.gender }}</span>
                </td>
                <td class="text-center">
                  <h3>Birth Date</h3>
                </td>
                <td>
                  <span>{{ current_subscription?.user.birthday }}</span>
                </td>
              </tr>
              <tr>
                <td class="no">03</td>
                <td class="text-center">
                  <h3>Height</h3>
                </td>
                <td>
                  <span>{{ current_subscription?.user.height }}</span>
                </td>
                <td class="text-center">
                  <h3>Weight</h3>
                </td>
                <td>
                  <span>{{ current_subscription?.user.Weight }}</span>
                </td>
              </tr>
              <tr>
                <td class="no">04</td>
                <td class="text-center">
                  <h3>Email</h3>
                </td>
                <td style="word-break: break-all;">
                  <span>{{ current_subscription?.user.email }}</span>
                </td>
                <td class="text-center">
                  <h3>Land Line</h3>
                </td>
                <td>
                  <span>{{ current_subscription?.user.land_line }}</span>
                </td>
              </tr>
              <tr>
                <td class="no">05</td>
                <td class="text-center">
                  <h3>Mobile Number</h3>
                </td>
                <td>
                  <span>{{ current_subscription?.user.phone_number }}</span>
                </td>
                <td class="text-center">
                  <h3>Second Mobile Number</h3>
                </td>
                <td>
                  <span>{{ current_subscription?.user.second_phone_number }}</span>
                </td>
              </tr>
              <tr>
                <td class="no">06</td>
                <td class="text-center">
                  <h3>Note</h3>
                </td>
                <td colspan="3">
                  <span>{{ current_subscription?.note }}</span>
                </td>
              </tr>
            </tbody>
          </table>

          <table cellspacing="0" cellpadding="0" style="text-align: center">
            <thead>
              <tr>
                <th>#</th>
                <th colspan="4"><i>Delivery Deatils</i></th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="no">01</td>
                <td class="text-center">
                  <h3>Start Date</h3>
                </td>
                <td colspan="3">
                  <span>{{ current_subscription?.delivery_starting_day }}</span>
                </td>
              </tr>
              <tr>
                <td class="no">02</td>
                <td class="text-center">
                  <h3>Emirate</h3>
                </td>
                <td>
                  <span>{{ current_subscription?.location.emirate.en_name }}</span>
                </td>
              </tr>
              <tr>
                <td class="no">03</td>
                <td class="text-center">
                  <h3>Land mark</h3>
                </td>
                <td colspan="3">
                  <span>{{ current_subscription?.location.landmark }}</span>
                </td>
              </tr>
              <tr>
                <td class="no">04</td>
                <td class="text-center">
                  <h3>Villa / Flat</h3>
                </td>
                <td colspan="3">
                  <span>{{ current_subscription?.location.property_number }}</span>
                </td>
              </tr>
              <tr>
                <td class="no">05</td>
                <td class="text-center">
                  <h3>Area</h3>
                </td>
                <td colspan="3">
                  <span>{{ current_subscription?.location.area_id }}</span>
                </td>
              </tr>
              <tr>
                <td class="no">06</td>
                <td class="text-center">
                  <h3>Delivery days</h3>
                </td>
                <td colspan="3" style="line-break: auto;">
                  <span style="word-break: break-all;">{{ current_subscription?.days_of_week }}</span>
                </td>
              </tr>
            </tbody>
          </table>

        </main>
      </div>
    </div>
  </div>
</p-dialog>

<p-dialog header="Details Modal" [(visible)]="callGearModal" [modal]="true" [style]="{width: '50vw'}" [draggable]="true"
  [resizable]="true">
  <div class="card">
    <div class="card-header">
      <div class="text-muted d-flex align-items-center">
        <h6 class="m-0" style="width: 200px;">Title</h6>
        <h6 class="m-0" style="width: 400px;">Description</h6>
        <h6 class="m-0">Download</h6>
      </div>
    </div>
    <div class="card-body">
      <div class="table-responsive overflow-auto">
        <table class="table">
          <tbody>
            <tr *ngFor="let call of current_callGear?.call_records;let i = index">
              <td style="vertical-align: middle;">#{{i+1}}</td>
              <td>
                <audio controls>
                  <source [src]="current_callGear.call_records" type="audio/mpeg">
                </audio>
              </td>
              <td style="vertical-align: middle;">
                <!-- <button class="btn btn-primary rounded-pill b1"
                  (click)="convertAudioToBase64('https://app.callgear.com/system/media/talk/',current_callGear.communication_id,call)">
                  Download Call
                </button> -->
                <a class="btn btn-primary rounded-pill b1" target="_blank"
                  [href]="current_callGear.call_records">Download Call</a>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</p-dialog>

<p-dialog header="Details Modal" [(visible)]="employeeCallModal" [modal]="true" [style]="{width: '50vw'}"
  [draggable]="true" [resizable]="true">
  <p-table [value]="current_callEmp">
    <ng-template pTemplate="header">
      <tr>
        <th class="text-center">Employee Name</th>
        <th class="text-center">is Answered</th>
        <th class="text-center">is Talked </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-callGear>
      <tr>
        <td class="text-center">{{callGear?.employee_full_name}}</td>
        <td class="text-center">
          <p-tag [severity]="getSeverity(callGear.is_answered ? 2 : 0)"
            [value]="callGear.is_answered ? 'Call Answered' :'Call Missed'">
          </p-tag>
        </td>
        <td class="text-center">
          <p-tag [severity]="getSeverity(callGear.is_talked ? 2 : 1)"
            [value]="callGear.is_talked ? 'Employee Talked' :'Employee Listened'">
          </p-tag>
        </td>
      </tr>
    </ng-template>
  </p-table>
</p-dialog>